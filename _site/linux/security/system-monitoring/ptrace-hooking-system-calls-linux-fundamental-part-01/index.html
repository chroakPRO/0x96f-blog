<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.27.1 by Michael Rose
  Copyright 2013-2025 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->

<html lang="en-US" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>ptrace System Call Hooking in Python - Building a File Access Monitor - 0x96f blog</title>
<meta name="description" content="Learn to build a Python-based file access monitoring tool using ptrace to intercept and analyze system calls for security monitoring and process behavior analysis.">


  <meta name="author" content="Chris Ek">
  
  <meta property="article:author" content="Chris Ek">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="0x96f blog">
<meta property="og:title" content="ptrace System Call Hooking in Python - Building a File Access Monitor">
<meta property="og:url" content="http://localhost:4000/linux/security/system-monitoring/ptrace-hooking-system-calls-linux-fundamental-part-01/">


  <meta property="og:description" content="Learn to build a Python-based file access monitoring tool using ptrace to intercept and analyze system calls for security monitoring and process behavior analysis.">







  <meta property="article:published_time" content="2025-07-15T00:00:00+02:00">





  

  


<link rel="canonical" href="http://localhost:4000/linux/security/system-monitoring/ptrace-hooking-system-calls-linux-fundamental-part-01/">












<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="0x96f blog Feed">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
  
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css"></noscript>



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single" dir="ltr">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          0x96f blog
          
        </a>
        <ul class="visible-links"></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      





<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person" class="h-card">

  

  <div class="author__content">
    <h3 class="author__name p-name" itemprop="name">
      <a class="u-url" rel="me" href="http://localhost:4000/" itemprop="url">Chris Ek</a>
    </h3>
    
      <div class="author__bio p-note" itemprop="description">
        <p>It’s like we’ve forgotten who we are. Explorers, pioneers, not caretakers… Cooper</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name" class="p-locality">Sweden</span>
        </li>
      

      
        
          
        
          
        
          
        
          
        
          
        
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer me">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="ptrace System Call Hooking in Python - Building a File Access Monitor">
    <meta itemprop="description" content="Learn to build a Python-based file access monitoring tool using ptrace to intercept and analyze system calls for security monitoring and process behavior analysis.">
    <meta itemprop="datePublished" content="2025-07-15T00:00:00+02:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">
            <a href="http://localhost:4000/linux/security/system-monitoring/ptrace-hooking-system-calls-linux-fundamental-part-01/" itemprop="url">ptrace System Call Hooking in Python - Building a File Access Monitor
</a>
          </h1>
          

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          9 minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right ">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-cog"></i> Contents</h4></header>
              <ul class="toc__menu"><li><a href="#overview">Overview</a></li><li><a href="#introduction">Introduction</a><ul><li><a href="#the-need-for-file-access-monitoring">The Need for File Access Monitoring</a></li><li><a href="#why-ptrace--python">Why ptrace + Python?</a></li><li><a href="#what-well-build">What We’ll Build</a></li></ul></li><li><a href="#problem-statement">Problem Statement</a><ul><li><a href="#the-challenge">The Challenge</a></li><li><a href="#our-solution-approach">Our Solution Approach</a></li></ul></li><li><a href="#core-concepts">Core Concepts</a><ul><li><a href="#concept-1-python-ctypes-and-ptrace-integration">Concept 1: Python ctypes and ptrace Integration</a></li><li><a href="#concept-2-file-system-call-interception">Concept 2: File System Call Interception</a></li><li><a href="#concept-3-process-context-and-metadata">Concept 3: Process Context and Metadata</a></li></ul></li><li><a href="#step-by-step-implementation">Step-by-Step Implementation</a><ul><li><a href="#phase-1-core-infrastructure">Phase 1: Core Infrastructure</a><ul><li><a href="#step-1-main-entry-point-mainpy">Step 1: Main Entry Point (main.py)</a></li><li><a href="#step-2-system-call-definitions-syscallspy">Step 2: System Call Definitions (syscalls.py)</a></li></ul></li><li><a href="#phase-2-process-tracing-implementation">Phase 2: Process Tracing Implementation</a><ul><li><a href="#step-3-core-tracer-class-tracerpy">Step 3: Core Tracer Class (tracer.py)</a></li><li><a href="#step-4-memory-reading-and-syscall-parsing">Step 4: Memory Reading and Syscall Parsing</a></li></ul></li><li><a href="#phase-3-enhanced-logging-and-monitoring">Phase 3: Enhanced Logging and Monitoring</a><ul><li><a href="#step-5-rich-file-access-logging">Step 5: Rich File Access Logging</a></li><li><a href="#step-6-utility-functions-utilspy">Step 6: Utility Functions (utils.py)</a></li></ul></li></ul></li><li><a href="#real-world-examples">Real-World Examples</a><ul><li><a href="#example-1-security-monitoring">Example 1: Security Monitoring</a></li><li><a href="#example-2-application-behavior-analysis">Example 2: Application Behavior Analysis</a></li></ul></li><li><a href="#performance-considerations">Performance Considerations</a><ul><li><a href="#overhead-analysis">Overhead Analysis</a></li><li><a href="#optimization-strategies">Optimization Strategies</a></li></ul></li><li><a href="#common-pitfalls--solutions">Common Pitfalls &amp; Solutions</a><ul><li><a href="#pitfall-1-permission-errors">Pitfall 1: Permission Errors</a></li><li><a href="#pitfall-2-process-state-confusion">Pitfall 2: Process State Confusion</a></li></ul></li><li><a href="#best-practices">Best Practices</a><ul><li><a href="#security-considerations">Security Considerations</a></li><li><a href="#code-organization">Code Organization</a></li></ul></li><li><a href="#usage-examples">Usage Examples</a><ul><li><a href="#basic-file-monitoring">Basic File Monitoring</a></li><li><a href="#advanced-use-cases">Advanced Use Cases</a></li></ul></li><li><a href="#conclusion">Conclusion</a><ul><li><a href="#key-takeaways">Key Takeaways</a></li><li><a href="#next-steps">Next Steps</a></li></ul></li><li><a href="#additional-resources">Additional Resources</a><ul><li><a href="#python-security-libraries">Python Security Libraries</a></li><li><a href="#system-programming">System Programming</a></li></ul></li></ul>
            </nav>
          </aside>
        
        <h2 id="overview">Overview</h2>
<p><strong>Target Audience:</strong> Security researchers, system administrators, Python developers<br />
<strong>Reading Time:</strong> 15-20 minutes<br />
<strong>Difficulty Level:</strong> Intermediate to Advanced<br />
<strong>What You’ll Learn:</strong></p>
<ul>
  <li>Building ptrace-based monitoring tools in Python</li>
  <li>Intercepting file-related system calls (open, read, write, close)</li>
  <li>Process behavior analysis and security monitoring</li>
  <li>Python ctypes integration with low-level system interfaces</li>
  <li>Real-time file access auditing techniques</li>
</ul>

<p><strong>Prerequisites:</strong></p>
<ul>
  <li>Strong Python programming knowledge</li>
  <li>Basic understanding of Linux system calls</li>
  <li>Familiarity with process management concepts</li>
  <li>Command line experience</li>
</ul>

<h2 id="introduction">Introduction</h2>

<h3 id="the-need-for-file-access-monitoring">The Need for File Access Monitoring</h3>

<p>In today’s security landscape, understanding what files a process accesses is crucial for:</p>
<ul>
  <li>Security incident response and forensics</li>
  <li>Malware behavior analysis</li>
  <li>Compliance monitoring and audit trails</li>
  <li>Detecting unauthorized file access</li>
  <li>Understanding application behavior</li>
</ul>

<h3 id="why-ptrace--python">Why ptrace + Python?</h3>

<p>While traditional tools like <code class="language-plaintext highlighter-rouge">strace</code> provide basic system call tracing, building a custom solution offers:</p>
<ul>
  <li><strong>Programmatic control</strong> - Filter and process events in real-time</li>
  <li><strong>Enhanced logging</strong> - Rich metadata and context</li>
  <li><strong>Integration capabilities</strong> - Easy connection to larger security frameworks</li>
  <li><strong>Customization</strong> - Tailor monitoring to specific needs</li>
</ul>

<h3 id="what-well-build">What We’ll Build</h3>

<p>We’ll construct a complete file access monitoring system that can:</p>
<ul>
  <li>Attach to any running process</li>
  <li>Monitor file operations (open, read, write, close)</li>
  <li>Provide detailed metadata including permissions, ownership, and timestamps</li>
  <li>Display real-time file access events with context</li>
</ul>

<h2 id="problem-statement">Problem Statement</h2>

<h3 id="the-challenge">The Challenge</h3>

<p>System administrators and security teams need visibility into file access patterns but face limitations:</p>

<ul>
  <li><strong>Black box processes</strong> - No insight into what files applications access</li>
  <li><strong>Performance overhead</strong> - Traditional monitoring tools can be resource-intensive</li>
  <li><strong>Limited context</strong> - Basic tools show operations but lack rich metadata</li>
  <li><strong>Integration gaps</strong> - Difficulty connecting monitoring to security workflows</li>
</ul>

<h3 id="our-solution-approach">Our Solution Approach</h3>

<p>We’ll build a Python-based monitoring tool that leverages ptrace to provide:</p>
<ul>
  <li>Real-time file access monitoring with minimal overhead</li>
  <li>Rich metadata including file permissions, ownership, and timestamps</li>
  <li>Flexible filtering and customization options</li>
  <li>Clean, readable output suitable for analysis</li>
</ul>

<h2 id="core-concepts">Core Concepts</h2>

<h3 id="concept-1-python-ctypes-and-ptrace-integration">Concept 1: Python ctypes and ptrace Integration</h3>

<p><strong>Definition:</strong> Using Python’s ctypes library to interface directly with the ptrace system call, enabling low-level process control from high-level Python code.</p>

<p><strong>Why It Matters:</strong> This combination provides the power of C-level system programming with Python’s ease of use and rapid development capabilities.</p>

<p><strong>Key Components:</strong></p>
<ul>
  <li><strong>ctypes.CDLL</strong> - Interface to libc for ptrace calls</li>
  <li><strong>Structure classes</strong> - Represent C structures in Python</li>
  <li><strong>Register access</strong> - Reading CPU registers to extract syscall information</li>
</ul>

<h3 id="concept-2-file-system-call-interception">Concept 2: File System Call Interception</h3>

<p><strong>Definition:</strong> Monitoring specific system calls related to file operations to track process file access behavior.</p>

<p><strong>Target System Calls:</strong></p>
<ul>
  <li><strong>open/openat</strong> - File opening operations</li>
  <li><strong>read</strong> - Reading data from files</li>
  <li><strong>write</strong> - Writing data to files</li>
  <li><strong>close</strong> - Closing file descriptors</li>
</ul>

<h3 id="concept-3-process-context-and-metadata">Concept 3: Process Context and Metadata</h3>

<p><strong>Definition:</strong> Enriching basic system call information with process details and file metadata to provide comprehensive monitoring context.</p>

<p><strong>Enhanced Information:</strong></p>
<ul>
  <li>Process name, user, and command line</li>
  <li>File permissions, ownership, and timestamps</li>
  <li>File descriptor to path mapping</li>
  <li>Socket information for network connections</li>
</ul>

<h2 id="step-by-step-implementation">Step-by-Step Implementation</h2>

<h3 id="phase-1-core-infrastructure">Phase 1: Core Infrastructure</h3>

<h4 id="step-1-main-entry-point-mainpy">Step 1: Main Entry Point (<code class="language-plaintext highlighter-rouge">main.py</code>)</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env python3
</span><span class="kn">import</span> <span class="n">sys</span>
<span class="kn">import</span> <span class="n">signal</span>
<span class="kn">from</span> <span class="n">tracer</span> <span class="kn">import</span> <span class="n">ProcessTracer</span>
<span class="kn">from</span> <span class="n">utils</span> <span class="kn">import</span> <span class="n">validate_pid</span><span class="p">,</span> <span class="n">get_process_info</span>

<span class="k">def</span> <span class="nf">signal_handler</span><span class="p">(</span><span class="n">signum</span><span class="p">,</span> <span class="n">frame</span><span class="p">):</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="s">[INFO] Shutting down...</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">sys</span><span class="p">.</span><span class="nf">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Usage: python main.py &lt;PID&gt;</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">sys</span><span class="p">.</span><span class="nf">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">pid</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">except</span> <span class="nb">ValueError</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Error: PID must be a number</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">sys</span><span class="p">.</span><span class="nf">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="nf">validate_pid</span><span class="p">(</span><span class="n">pid</span><span class="p">):</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Error: Process </span><span class="si">{</span><span class="n">pid</span><span class="si">}</span><span class="s"> not found or not accessible</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">sys</span><span class="p">.</span><span class="nf">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="n">signal</span><span class="p">.</span><span class="nf">signal</span><span class="p">(</span><span class="n">signal</span><span class="p">.</span><span class="n">SIGINT</span><span class="p">,</span> <span class="n">signal_handler</span><span class="p">)</span>
    <span class="n">process_name</span> <span class="o">=</span> <span class="nf">get_process_info</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">[INFO] Monitoring file access for PID </span><span class="si">{</span><span class="n">pid</span><span class="si">}</span><span class="s"> (</span><span class="si">{</span><span class="n">process_name</span><span class="si">}</span><span class="s">)</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">[INFO] Press Ctrl+C to stop</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">-</span><span class="sh">"</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
    
    <span class="n">tracer</span> <span class="o">=</span> <span class="nc">ProcessTracer</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">tracer</span><span class="p">.</span><span class="nf">attach</span><span class="p">()</span>
        <span class="n">tracer</span><span class="p">.</span><span class="nf">monitor_syscalls</span><span class="p">()</span>
    <span class="k">except</span> <span class="n">PermissionError</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Error: Permission denied. Try running with sudo.</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">'</span><span class="s">__main__</span><span class="sh">'</span><span class="p">:</span>
    <span class="nf">main</span><span class="p">()</span>
</code></pre></div></div>

<p><strong>Explanation:</strong> This entry point handles command-line arguments, validates the target PID, and initializes the monitoring system with proper error handling.</p>

<h4 id="step-2-system-call-definitions-syscallspy">Step 2: System Call Definitions (<code class="language-plaintext highlighter-rouge">syscalls.py</code>)</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># x86_64 syscall numbers for file operations
</span><span class="n">FILE_SYSCALLS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mi">0</span><span class="p">:</span> <span class="sh">'</span><span class="s">read</span><span class="sh">'</span><span class="p">,</span>
    <span class="mi">1</span><span class="p">:</span> <span class="sh">'</span><span class="s">write</span><span class="sh">'</span><span class="p">,</span> 
    <span class="mi">2</span><span class="p">:</span> <span class="sh">'</span><span class="s">open</span><span class="sh">'</span><span class="p">,</span>
    <span class="mi">3</span><span class="p">:</span> <span class="sh">'</span><span class="s">close</span><span class="sh">'</span><span class="p">,</span>
    <span class="mi">257</span><span class="p">:</span> <span class="sh">'</span><span class="s">openat</span><span class="sh">'</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># Syscall argument positions (x86_64 calling convention)
</span><span class="n">SYSCALL_ARGS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="sh">'</span><span class="s">open</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="sh">'</span><span class="s">filename</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">flags</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">mode</span><span class="sh">'</span><span class="p">],</span>      <span class="c1"># rdi, rsi, rdx
</span>    <span class="sh">'</span><span class="s">openat</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="sh">'</span><span class="s">dirfd</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">filename</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">flags</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">mode</span><span class="sh">'</span><span class="p">],</span>  <span class="c1"># rdi, rsi, rdx, r10
</span>    <span class="sh">'</span><span class="s">read</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="sh">'</span><span class="s">fd</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">buffer</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">count</span><span class="sh">'</span><span class="p">],</span>          <span class="c1"># rdi, rsi, rdx
</span>    <span class="sh">'</span><span class="s">write</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="sh">'</span><span class="s">fd</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">buffer</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">count</span><span class="sh">'</span><span class="p">],</span>         <span class="c1"># rdi, rsi, rdx
</span>    <span class="sh">'</span><span class="s">close</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="sh">'</span><span class="s">fd</span><span class="sh">'</span><span class="p">],</span>                            <span class="c1"># rdi
</span><span class="p">}</span>

<span class="k">def</span> <span class="nf">is_file_syscall</span><span class="p">(</span><span class="n">syscall_num</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Check if syscall is file-related</span><span class="sh">"""</span>
    <span class="k">return</span> <span class="n">syscall_num</span> <span class="ow">in</span> <span class="n">FILE_SYSCALLS</span>

<span class="k">def</span> <span class="nf">get_syscall_name</span><span class="p">(</span><span class="n">syscall_num</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Get syscall name from number</span><span class="sh">"""</span>
    <span class="k">return</span> <span class="n">FILE_SYSCALLS</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">syscall_num</span><span class="p">,</span> <span class="sa">f</span><span class="sh">"</span><span class="s">syscall_</span><span class="si">{</span><span class="n">syscall_num</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="phase-2-process-tracing-implementation">Phase 2: Process Tracing Implementation</h3>

<h4 id="step-3-core-tracer-class-tracerpy">Step 3: Core Tracer Class (<code class="language-plaintext highlighter-rouge">tracer.py</code>)</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">os</span>
<span class="kn">import</span> <span class="n">sys</span>
<span class="kn">import</span> <span class="n">ctypes</span>
<span class="kn">import</span> <span class="n">signal</span>
<span class="kn">from</span> <span class="n">ctypes</span> <span class="kn">import</span> <span class="n">c_long</span><span class="p">,</span> <span class="n">c_int</span><span class="p">,</span> <span class="n">c_void_p</span><span class="p">,</span> <span class="n">Structure</span>
<span class="kn">from</span> <span class="n">syscalls</span> <span class="kn">import</span> <span class="n">is_file_syscall</span><span class="p">,</span> <span class="n">get_syscall_name</span>
<span class="kn">from</span> <span class="n">utils</span> <span class="kn">import</span> <span class="n">format_flags</span><span class="p">,</span> <span class="n">fd_to_path</span><span class="p">,</span> <span class="n">get_process_info</span>
<span class="kn">import</span> <span class="n">time</span>

<span class="c1"># ptrace constants
</span><span class="n">PTRACE_ATTACH</span> <span class="o">=</span> <span class="mi">16</span>
<span class="n">PTRACE_DETACH</span> <span class="o">=</span> <span class="mi">17</span>
<span class="n">PTRACE_SYSCALL</span> <span class="o">=</span> <span class="mi">24</span>
<span class="n">PTRACE_GETREGS</span> <span class="o">=</span> <span class="mi">12</span>

<span class="k">class</span> <span class="nc">user_regs_struct</span><span class="p">(</span><span class="n">Structure</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">x86_64 register structure for accessing syscall arguments</span><span class="sh">"""</span>
    <span class="n">_fields_</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="sh">"</span><span class="s">r15</span><span class="sh">"</span><span class="p">,</span> <span class="n">c_long</span><span class="p">),</span> <span class="p">(</span><span class="sh">"</span><span class="s">r14</span><span class="sh">"</span><span class="p">,</span> <span class="n">c_long</span><span class="p">),</span> <span class="p">(</span><span class="sh">"</span><span class="s">r13</span><span class="sh">"</span><span class="p">,</span> <span class="n">c_long</span><span class="p">),</span> <span class="p">(</span><span class="sh">"</span><span class="s">r12</span><span class="sh">"</span><span class="p">,</span> <span class="n">c_long</span><span class="p">),</span>
        <span class="p">(</span><span class="sh">"</span><span class="s">rbp</span><span class="sh">"</span><span class="p">,</span> <span class="n">c_long</span><span class="p">),</span> <span class="p">(</span><span class="sh">"</span><span class="s">rbx</span><span class="sh">"</span><span class="p">,</span> <span class="n">c_long</span><span class="p">),</span> <span class="p">(</span><span class="sh">"</span><span class="s">r11</span><span class="sh">"</span><span class="p">,</span> <span class="n">c_long</span><span class="p">),</span> <span class="p">(</span><span class="sh">"</span><span class="s">r10</span><span class="sh">"</span><span class="p">,</span> <span class="n">c_long</span><span class="p">),</span>
        <span class="p">(</span><span class="sh">"</span><span class="s">r9</span><span class="sh">"</span><span class="p">,</span> <span class="n">c_long</span><span class="p">),</span> <span class="p">(</span><span class="sh">"</span><span class="s">r8</span><span class="sh">"</span><span class="p">,</span> <span class="n">c_long</span><span class="p">),</span> <span class="p">(</span><span class="sh">"</span><span class="s">rax</span><span class="sh">"</span><span class="p">,</span> <span class="n">c_long</span><span class="p">),</span> <span class="p">(</span><span class="sh">"</span><span class="s">rcx</span><span class="sh">"</span><span class="p">,</span> <span class="n">c_long</span><span class="p">),</span>
        <span class="p">(</span><span class="sh">"</span><span class="s">rdx</span><span class="sh">"</span><span class="p">,</span> <span class="n">c_long</span><span class="p">),</span> <span class="p">(</span><span class="sh">"</span><span class="s">rsi</span><span class="sh">"</span><span class="p">,</span> <span class="n">c_long</span><span class="p">),</span> <span class="p">(</span><span class="sh">"</span><span class="s">rdi</span><span class="sh">"</span><span class="p">,</span> <span class="n">c_long</span><span class="p">),</span> <span class="p">(</span><span class="sh">"</span><span class="s">orig_rax</span><span class="sh">"</span><span class="p">,</span> <span class="n">c_long</span><span class="p">),</span>
        <span class="p">(</span><span class="sh">"</span><span class="s">rip</span><span class="sh">"</span><span class="p">,</span> <span class="n">c_long</span><span class="p">),</span> <span class="p">(</span><span class="sh">"</span><span class="s">cs</span><span class="sh">"</span><span class="p">,</span> <span class="n">c_long</span><span class="p">),</span> <span class="p">(</span><span class="sh">"</span><span class="s">eflags</span><span class="sh">"</span><span class="p">,</span> <span class="n">c_long</span><span class="p">),</span> <span class="p">(</span><span class="sh">"</span><span class="s">rsp</span><span class="sh">"</span><span class="p">,</span> <span class="n">c_long</span><span class="p">),</span>
        <span class="p">(</span><span class="sh">"</span><span class="s">ss</span><span class="sh">"</span><span class="p">,</span> <span class="n">c_long</span><span class="p">),</span> <span class="p">(</span><span class="sh">"</span><span class="s">fs_base</span><span class="sh">"</span><span class="p">,</span> <span class="n">c_long</span><span class="p">),</span> <span class="p">(</span><span class="sh">"</span><span class="s">gs_base</span><span class="sh">"</span><span class="p">,</span> <span class="n">c_long</span><span class="p">),</span>
        <span class="p">(</span><span class="sh">"</span><span class="s">ds</span><span class="sh">"</span><span class="p">,</span> <span class="n">c_long</span><span class="p">),</span> <span class="p">(</span><span class="sh">"</span><span class="s">es</span><span class="sh">"</span><span class="p">,</span> <span class="n">c_long</span><span class="p">),</span> <span class="p">(</span><span class="sh">"</span><span class="s">fs</span><span class="sh">"</span><span class="p">,</span> <span class="n">c_long</span><span class="p">),</span> <span class="p">(</span><span class="sh">"</span><span class="s">gs</span><span class="sh">"</span><span class="p">,</span> <span class="n">c_long</span><span class="p">),</span>
    <span class="p">]</span>

<span class="k">class</span> <span class="nc">ProcessTracer</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">pid</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">pid</span> <span class="o">=</span> <span class="n">pid</span>
        <span class="n">self</span><span class="p">.</span><span class="n">libc</span> <span class="o">=</span> <span class="n">ctypes</span><span class="p">.</span><span class="nc">CDLL</span><span class="p">(</span><span class="sh">"</span><span class="s">libc.so.6</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">attached</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">self</span><span class="p">.</span><span class="n">process_info</span> <span class="o">=</span> <span class="nf">get_process_info</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="n">process_info</span><span class="p">:</span>
            <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">[INFO] Process details:</span><span class="sh">"</span><span class="p">)</span>
            <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">  Name: </span><span class="si">{</span><span class="n">self</span><span class="p">.</span><span class="n">process_info</span><span class="p">[</span><span class="sh">'</span><span class="s">name</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
            <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">  User: </span><span class="si">{</span><span class="n">self</span><span class="p">.</span><span class="n">process_info</span><span class="p">[</span><span class="sh">'</span><span class="s">user</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
            <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">  Command: </span><span class="si">{</span><span class="n">self</span><span class="p">.</span><span class="n">process_info</span><span class="p">[</span><span class="sh">'</span><span class="s">cmdline</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
            <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">  Working Dir: </span><span class="si">{</span><span class="n">self</span><span class="p">.</span><span class="n">process_info</span><span class="p">[</span><span class="sh">'</span><span class="s">cwd</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
            <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">  Started: </span><span class="si">{</span><span class="n">self</span><span class="p">.</span><span class="n">process_info</span><span class="p">[</span><span class="sh">'</span><span class="s">start_time</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
            <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">-</span><span class="sh">"</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">attach</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Attach to target process using ptrace</span><span class="sh">"""</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">libc</span><span class="p">.</span><span class="nf">ptrace</span><span class="p">(</span><span class="n">PTRACE_ATTACH</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">pid</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">result</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="nc">Exception</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Failed to attach to PID </span><span class="si">{</span><span class="n">self</span><span class="p">.</span><span class="n">pid</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">os</span><span class="p">.</span><span class="nf">waitpid</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">pid</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">attached</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">[INFO] Attached to process </span><span class="si">{</span><span class="n">self</span><span class="p">.</span><span class="n">pid</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">detach</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Detach from process cleanly</span><span class="sh">"""</span>
        <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="n">attached</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="n">libc</span><span class="p">.</span><span class="nf">ptrace</span><span class="p">(</span><span class="n">PTRACE_DETACH</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">pid</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">self</span><span class="p">.</span><span class="n">attached</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">[INFO] Detached from process </span><span class="si">{</span><span class="n">self</span><span class="p">.</span><span class="n">pid</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<h4 id="step-4-memory-reading-and-syscall-parsing">Step 4: Memory Reading and Syscall Parsing</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">def</span> <span class="nf">read_string</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="n">max_len</span><span class="o">=</span><span class="mi">256</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Read null-terminated string from process memory</span><span class="sh">"""</span>
        <span class="k">if</span> <span class="n">address</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="n">result</span> <span class="o">=</span> <span class="sh">""</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_len</span><span class="p">,</span> <span class="mi">8</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">libc</span><span class="p">.</span><span class="nf">ptrace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">pid</span><span class="p">,</span> <span class="n">address</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1"># PTRACE_PEEKDATA
</span>                <span class="k">if</span> <span class="n">data</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="n">bytes_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="nf">to_bytes</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="sh">'</span><span class="s">little</span><span class="sh">'</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">byte</span> <span class="ow">in</span> <span class="n">bytes_data</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">byte</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">result</span>
                    <span class="n">result</span> <span class="o">+=</span> <span class="nf">chr</span><span class="p">(</span><span class="n">byte</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">parse_syscall_args</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">regs</span><span class="p">,</span> <span class="n">syscall_name</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Extract syscall arguments based on x86_64 calling convention</span><span class="sh">"""</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">syscall_name</span> <span class="o">==</span> <span class="sh">'</span><span class="s">open</span><span class="sh">'</span><span class="p">:</span>
            <span class="n">args</span><span class="p">[</span><span class="sh">'</span><span class="s">filename</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">read_string</span><span class="p">(</span><span class="n">regs</span><span class="p">.</span><span class="n">rdi</span><span class="p">)</span>
            <span class="n">args</span><span class="p">[</span><span class="sh">'</span><span class="s">flags</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">regs</span><span class="p">.</span><span class="n">rsi</span>
            <span class="n">args</span><span class="p">[</span><span class="sh">'</span><span class="s">mode</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">regs</span><span class="p">.</span><span class="n">rdx</span>
        <span class="k">elif</span> <span class="n">syscall_name</span> <span class="o">==</span> <span class="sh">'</span><span class="s">openat</span><span class="sh">'</span><span class="p">:</span>
            <span class="n">args</span><span class="p">[</span><span class="sh">'</span><span class="s">dirfd</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">regs</span><span class="p">.</span><span class="n">rdi</span>
            <span class="n">args</span><span class="p">[</span><span class="sh">'</span><span class="s">filename</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">read_string</span><span class="p">(</span><span class="n">regs</span><span class="p">.</span><span class="n">rsi</span><span class="p">)</span>
            <span class="n">args</span><span class="p">[</span><span class="sh">'</span><span class="s">flags</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">regs</span><span class="p">.</span><span class="n">rdx</span>
            <span class="n">args</span><span class="p">[</span><span class="sh">'</span><span class="s">mode</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">regs</span><span class="p">.</span><span class="n">r10</span>
        <span class="k">elif</span> <span class="n">syscall_name</span> <span class="ow">in</span> <span class="p">[</span><span class="sh">'</span><span class="s">read</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">write</span><span class="sh">'</span><span class="p">]:</span>
            <span class="n">args</span><span class="p">[</span><span class="sh">'</span><span class="s">fd</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">regs</span><span class="p">.</span><span class="n">rdi</span>
            <span class="n">args</span><span class="p">[</span><span class="sh">'</span><span class="s">count</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">regs</span><span class="p">.</span><span class="n">rdx</span>
        <span class="k">elif</span> <span class="n">syscall_name</span> <span class="o">==</span> <span class="sh">'</span><span class="s">close</span><span class="sh">'</span><span class="p">:</span>
            <span class="n">args</span><span class="p">[</span><span class="sh">'</span><span class="s">fd</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">regs</span><span class="p">.</span><span class="n">rdi</span>
        <span class="k">return</span> <span class="n">args</span>
</code></pre></div></div>

<h3 id="phase-3-enhanced-logging-and-monitoring">Phase 3: Enhanced Logging and Monitoring</h3>

<h4 id="step-5-rich-file-access-logging">Step 5: Rich File Access Logging</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">def</span> <span class="nf">log_file_access</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">,</span> <span class="n">syscall_name</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Enhanced log file access event with detailed information</span><span class="sh">"""</span>
        <span class="n">proc_name</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">process_info</span><span class="p">[</span><span class="sh">'</span><span class="s">name</span><span class="sh">'</span><span class="p">]</span> <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="n">process_info</span> <span class="k">else</span> <span class="sh">'</span><span class="s">unknown</span><span class="sh">'</span>
        <span class="n">proc_user</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">process_info</span><span class="p">[</span><span class="sh">'</span><span class="s">user</span><span class="sh">'</span><span class="p">]</span> <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="n">process_info</span> <span class="k">else</span> <span class="sh">'</span><span class="s">unknown</span><span class="sh">'</span>
        
        <span class="k">if</span> <span class="n">syscall_name</span> <span class="ow">in</span> <span class="p">[</span><span class="sh">'</span><span class="s">open</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">openat</span><span class="sh">'</span><span class="p">]:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">args</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">filename</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">unknown</span><span class="sh">'</span><span class="p">)</span>
            <span class="n">flags</span> <span class="o">=</span> <span class="nf">format_flags</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">flags</span><span class="sh">'</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
            <span class="n">mode</span> <span class="o">=</span> <span class="nf">oct</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">mode</span><span class="sh">'</span><span class="p">,</span> <span class="mi">0</span><span class="p">))[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span>
            <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">[</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s">] </span><span class="si">{</span><span class="n">proc_name</span><span class="si">}</span><span class="s">(</span><span class="si">{</span><span class="n">self</span><span class="p">.</span><span class="n">pid</span><span class="si">}</span><span class="s">)[</span><span class="si">{</span><span class="n">proc_user</span><span class="si">}</span><span class="s">] OPEN: </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
            <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">  Flags: </span><span class="si">{</span><span class="n">flags</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
            <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">  Mode: </span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
            
        <span class="k">elif</span> <span class="n">syscall_name</span> <span class="o">==</span> <span class="sh">'</span><span class="s">read</span><span class="sh">'</span><span class="p">:</span>
            <span class="n">fd</span> <span class="o">=</span> <span class="n">args</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">fd</span><span class="sh">'</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">count</span> <span class="o">=</span> <span class="n">args</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">count</span><span class="sh">'</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">path</span> <span class="o">=</span> <span class="nf">fd_to_path</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">pid</span><span class="p">,</span> <span class="n">fd</span><span class="p">)</span>
            <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">[</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s">] </span><span class="si">{</span><span class="n">proc_name</span><span class="si">}</span><span class="s">(</span><span class="si">{</span><span class="n">self</span><span class="p">.</span><span class="n">pid</span><span class="si">}</span><span class="s">)[</span><span class="si">{</span><span class="n">proc_user</span><span class="si">}</span><span class="s">] READ: </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
            <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">  Bytes requested: </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
            
        <span class="k">elif</span> <span class="n">syscall_name</span> <span class="o">==</span> <span class="sh">'</span><span class="s">write</span><span class="sh">'</span><span class="p">:</span>
            <span class="n">fd</span> <span class="o">=</span> <span class="n">args</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">fd</span><span class="sh">'</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">count</span> <span class="o">=</span> <span class="n">args</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">count</span><span class="sh">'</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">path</span> <span class="o">=</span> <span class="nf">fd_to_path</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">pid</span><span class="p">,</span> <span class="n">fd</span><span class="p">)</span>
            <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">[</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s">] </span><span class="si">{</span><span class="n">proc_name</span><span class="si">}</span><span class="s">(</span><span class="si">{</span><span class="n">self</span><span class="p">.</span><span class="n">pid</span><span class="si">}</span><span class="s">)[</span><span class="si">{</span><span class="n">proc_user</span><span class="si">}</span><span class="s">] WRITE: </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
            <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">  Bytes written: </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
            
        <span class="k">elif</span> <span class="n">syscall_name</span> <span class="o">==</span> <span class="sh">'</span><span class="s">close</span><span class="sh">'</span><span class="p">:</span>
            <span class="n">fd</span> <span class="o">=</span> <span class="n">args</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">fd</span><span class="sh">'</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">path</span> <span class="o">=</span> <span class="nf">fd_to_path</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">pid</span><span class="p">,</span> <span class="n">fd</span><span class="p">)</span>
            <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">[</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s">] </span><span class="si">{</span><span class="n">proc_name</span><span class="si">}</span><span class="s">(</span><span class="si">{</span><span class="n">self</span><span class="p">.</span><span class="n">pid</span><span class="si">}</span><span class="s">)[</span><span class="si">{</span><span class="n">proc_user</span><span class="si">}</span><span class="s">] CLOSE: </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">monitor_syscalls</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Main monitoring loop with enhanced file syscall handling</span><span class="sh">"""</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
                <span class="n">self</span><span class="p">.</span><span class="nf">continue_syscall</span><span class="p">()</span>
                <span class="n">regs</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">get_registers</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">regs</span><span class="p">:</span>
                    <span class="n">self</span><span class="p">.</span><span class="nf">handle_syscall</span><span class="p">(</span><span class="n">regs</span><span class="p">)</span>
                <span class="n">self</span><span class="p">.</span><span class="nf">continue_syscall</span><span class="p">()</span>
        <span class="k">except</span> <span class="nb">KeyboardInterrupt</span><span class="p">:</span>
            <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="s">[INFO] Monitoring stopped</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">except</span> <span class="nb">ProcessLookupError</span><span class="p">:</span>
            <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">[INFO] Process </span><span class="si">{</span><span class="n">self</span><span class="p">.</span><span class="n">pid</span><span class="si">}</span><span class="s"> terminated</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="nf">detach</span><span class="p">()</span>
</code></pre></div></div>

<h4 id="step-6-utility-functions-utilspy">Step 6: Utility Functions (<code class="language-plaintext highlighter-rouge">utils.py</code>)</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">os</span>
<span class="kn">import</span> <span class="n">pwd</span>
<span class="kn">import</span> <span class="n">grp</span>
<span class="kn">import</span> <span class="n">psutil</span>
<span class="kn">from</span> <span class="n">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>

<span class="k">def</span> <span class="nf">get_process_info</span><span class="p">(</span><span class="n">pid</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Get comprehensive process information</span><span class="sh">"""</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">proc</span> <span class="o">=</span> <span class="n">psutil</span><span class="p">.</span><span class="nc">Process</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">name</span><span class="sh">'</span><span class="p">:</span> <span class="n">proc</span><span class="p">.</span><span class="nf">name</span><span class="p">(),</span>
            <span class="sh">'</span><span class="s">user</span><span class="sh">'</span><span class="p">:</span> <span class="n">proc</span><span class="p">.</span><span class="nf">username</span><span class="p">(),</span>
            <span class="sh">'</span><span class="s">cmdline</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s"> </span><span class="sh">'</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">proc</span><span class="p">.</span><span class="nf">cmdline</span><span class="p">()),</span>
            <span class="sh">'</span><span class="s">cwd</span><span class="sh">'</span><span class="p">:</span> <span class="n">proc</span><span class="p">.</span><span class="nf">cwd</span><span class="p">(),</span>
            <span class="sh">'</span><span class="s">start_time</span><span class="sh">'</span><span class="p">:</span> <span class="n">datetime</span><span class="p">.</span><span class="nf">fromtimestamp</span><span class="p">(</span><span class="n">proc</span><span class="p">.</span><span class="nf">create_time</span><span class="p">()).</span><span class="nf">strftime</span><span class="p">(</span><span class="sh">'</span><span class="s">%Y-%m-%d %H:%M:%S</span><span class="sh">'</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>

<span class="k">def</span> <span class="nf">fd_to_path</span><span class="p">(</span><span class="n">pid</span><span class="p">,</span> <span class="n">fd</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Enhanced fd to path resolution with metadata</span><span class="sh">"""</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="nf">readlink</span><span class="p">(</span><span class="sa">f</span><span class="sh">'</span><span class="s">/proc/</span><span class="si">{</span><span class="n">pid</span><span class="si">}</span><span class="s">/fd/</span><span class="si">{</span><span class="n">fd</span><span class="si">}</span><span class="sh">'</span><span class="p">)</span>
        
        <span class="c1"># Handle different types of file descriptors
</span>        <span class="k">if</span> <span class="n">path</span><span class="p">.</span><span class="nf">startswith</span><span class="p">(</span><span class="sh">'</span><span class="s">socket:[</span><span class="sh">'</span><span class="p">):</span>
            <span class="n">inode</span> <span class="o">=</span> <span class="n">path</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">'</span><span class="s">[</span><span class="sh">'</span><span class="p">)[</span><span class="mi">1</span><span class="p">].</span><span class="nf">rstrip</span><span class="p">(</span><span class="sh">'</span><span class="s">]</span><span class="sh">'</span><span class="p">)</span>
            <span class="k">return</span> <span class="nf">get_socket_info</span><span class="p">(</span><span class="n">pid</span><span class="p">,</span> <span class="n">inode</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="n">metadata</span> <span class="o">=</span> <span class="nf">get_file_metadata</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="k">return</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s"> (</span><span class="si">{</span><span class="n">metadata</span><span class="si">}</span><span class="s">)</span><span class="sh">"</span> <span class="k">if</span> <span class="n">metadata</span> <span class="k">else</span> <span class="n">path</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">path</span>
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="sh">'</span><span class="s">fd=</span><span class="si">{</span><span class="n">fd</span><span class="si">}</span><span class="sh">'</span>

<span class="k">def</span> <span class="nf">format_flags</span><span class="p">(</span><span class="n">flags</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Convert open flags to readable format</span><span class="sh">"""</span>
    <span class="n">flag_names</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">flags</span> <span class="o">&amp;</span> <span class="mo">0o0</span><span class="p">:</span>     <span class="n">flag_names</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="sh">'</span><span class="s">O_RDONLY</span><span class="sh">'</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">flags</span> <span class="o">&amp;</span> <span class="mo">0o1</span><span class="p">:</span>     <span class="n">flag_names</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="sh">'</span><span class="s">O_WRONLY</span><span class="sh">'</span><span class="p">)</span> 
    <span class="k">if</span> <span class="n">flags</span> <span class="o">&amp;</span> <span class="mo">0o2</span><span class="p">:</span>     <span class="n">flag_names</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="sh">'</span><span class="s">O_RDWR</span><span class="sh">'</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">flags</span> <span class="o">&amp;</span> <span class="mo">0o100</span><span class="p">:</span>   <span class="n">flag_names</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="sh">'</span><span class="s">O_CREAT</span><span class="sh">'</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">flags</span> <span class="o">&amp;</span> <span class="mo">0o1000</span><span class="p">:</span>  <span class="n">flag_names</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="sh">'</span><span class="s">O_TRUNC</span><span class="sh">'</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">flags</span> <span class="o">&amp;</span> <span class="mo">0o2000</span><span class="p">:</span>  <span class="n">flag_names</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="sh">'</span><span class="s">O_APPEND</span><span class="sh">'</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">flags</span> <span class="o">&amp;</span> <span class="mo">0o4000</span><span class="p">:</span>  <span class="n">flag_names</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="sh">'</span><span class="s">O_NONBLOCK</span><span class="sh">'</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">flags</span> <span class="o">&amp;</span> <span class="mo">0o200000</span><span class="p">:</span> <span class="n">flag_names</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="sh">'</span><span class="s">O_CLOEXEC</span><span class="sh">'</span><span class="p">)</span>
    <span class="k">return</span> <span class="sh">'</span><span class="s">|</span><span class="sh">'</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">flag_names</span><span class="p">)</span> <span class="k">if</span> <span class="n">flag_names</span> <span class="k">else</span> <span class="sa">f</span><span class="sh">'</span><span class="s">0x</span><span class="si">{</span><span class="n">flags</span><span class="si">:</span><span class="n">x</span><span class="si">}</span><span class="sh">'</span>
</code></pre></div></div>

<h2 id="real-world-examples">Real-World Examples</h2>

<h3 id="example-1-security-monitoring">Example 1: Security Monitoring</h3>

<p><strong>Scenario:</strong> Monitoring a web server process for suspicious file access patterns.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Monitor nginx process</span>
<span class="nb">sudo </span>python3 main.py <span class="si">$(</span>pgrep nginx | <span class="nb">head</span> <span class="nt">-1</span><span class="si">)</span>

<span class="c"># Example output:</span>
<span class="o">[</span>INFO] Monitoring file access <span class="k">for </span>PID 1234 <span class="o">(</span>nginx<span class="o">)</span>
<span class="o">[</span>INFO] Process details:
  Name: nginx
  User: www-data
  Command: nginx: worker process
  Working Dir: /
  Started: 2025-07-15 10:30:15
<span class="nt">--------------------------------------------------</span>
<span class="o">[</span>10:45:23] nginx<span class="o">(</span>1234<span class="o">)[</span>www-data] OPEN: /var/log/nginx/access.log
  Flags: O_WRONLY|O_APPEND
  Mode: 0644
<span class="o">[</span>10:45:23] nginx<span class="o">(</span>1234<span class="o">)[</span>www-data] WRITE: /var/log/nginx/access.log <span class="o">(</span><span class="nv">owner</span><span class="o">=</span>www-data:adm <span class="nv">mode</span><span class="o">=</span>0644 <span class="nv">size</span><span class="o">=</span>1024 <span class="nv">mtime</span><span class="o">=</span>2025-07-15 10:45:23<span class="o">)</span>
  Bytes written: 127
</code></pre></div></div>

<h3 id="example-2-application-behavior-analysis">Example 2: Application Behavior Analysis</h3>

<p><strong>Scenario:</strong> Understanding what configuration files an application reads during startup.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Start monitoring before application launch</span>
<span class="nb">sudo </span>python3 main.py <span class="si">$(</span>pgrep myapp<span class="si">)</span>

<span class="c"># Output shows configuration file access:</span>
<span class="o">[</span>10:50:15] myapp<span class="o">(</span>5678<span class="o">)[</span>user] OPEN: /etc/myapp/config.yaml
  Flags: O_RDONLY
  Mode: 0000
<span class="o">[</span>10:50:15] myapp<span class="o">(</span>5678<span class="o">)[</span>user] READ: /etc/myapp/config.yaml <span class="o">(</span><span class="nv">owner</span><span class="o">=</span>root:root <span class="nv">mode</span><span class="o">=</span>0644 <span class="nv">size</span><span class="o">=</span>2048 <span class="nv">mtime</span><span class="o">=</span>2025-07-15 09:30:00<span class="o">)</span>
  Bytes requested: 2048
</code></pre></div></div>

<h2 id="performance-considerations">Performance Considerations</h2>

<h3 id="overhead-analysis">Overhead Analysis</h3>

<p>Our Python implementation introduces overhead through:</p>
<ul>
  <li><strong>Python interpreter</strong> - Additional processing layer</li>
  <li><strong>ctypes calls</strong> - Function call overhead for each ptrace operation</li>
  <li><strong>String processing</strong> - Memory reading and parsing</li>
</ul>

<h3 id="optimization-strategies">Optimization Strategies</h3>

<ol>
  <li><strong>Selective Monitoring</strong> - Only trace file-related syscalls</li>
  <li><strong>Efficient Memory Reading</strong> - Read memory in chunks</li>
  <li><strong>Lazy Evaluation</strong> - Only resolve paths when needed</li>
</ol>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Example optimization: Cache file descriptor mappings
</span><span class="k">class</span> <span class="nc">ProcessTracer</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">pid</span><span class="p">):</span>
        <span class="c1"># ... existing code ...
</span>        <span class="n">self</span><span class="p">.</span><span class="n">fd_cache</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># Cache fd to path mappings
</span>        
    <span class="k">def</span> <span class="nf">fd_to_path_cached</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">fd</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">fd</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">fd_cache</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="n">fd_cache</span><span class="p">[</span><span class="n">fd</span><span class="p">]</span> <span class="o">=</span> <span class="nf">fd_to_path</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">pid</span><span class="p">,</span> <span class="n">fd</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="n">fd_cache</span><span class="p">[</span><span class="n">fd</span><span class="p">]</span>
</code></pre></div></div>

<h2 id="common-pitfalls--solutions">Common Pitfalls &amp; Solutions</h2>

<h3 id="pitfall-1-permission-errors">Pitfall 1: Permission Errors</h3>

<p><strong>Description:</strong> Insufficient privileges to attach to target processes.</p>

<p><strong>Symptoms:</strong></p>
<ul>
  <li>“Permission denied” errors</li>
  <li>Failed ptrace attachment</li>
</ul>

<p><strong>Solution:</strong></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Run with sudo</span>
<span class="nb">sudo </span>python3 main.py &lt;PID&gt;

<span class="c"># Or add capabilities (for production deployment)</span>
<span class="nb">sudo </span>setcap cap_sys_ptrace+ep /usr/bin/python3
</code></pre></div></div>

<h3 id="pitfall-2-process-state-confusion">Pitfall 2: Process State Confusion</h3>

<p><strong>Description:</strong> Target process in uninterruptible state or zombie state.</p>

<p><strong>Solution:</strong></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">validate_pid</span><span class="p">(</span><span class="n">pid</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Enhanced PID validation with state checking</span><span class="sh">"""</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">proc</span> <span class="o">=</span> <span class="n">psutil</span><span class="p">.</span><span class="nc">Process</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">proc</span><span class="p">.</span><span class="nf">status</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="n">psutil</span><span class="p">.</span><span class="n">STATUS_ZOMBIE</span><span class="p">,</span> <span class="n">psutil</span><span class="p">.</span><span class="n">STATUS_DEAD</span><span class="p">]:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="bp">True</span>
    <span class="nf">except </span><span class="p">(</span><span class="n">psutil</span><span class="p">.</span><span class="n">NoSuchProcess</span><span class="p">,</span> <span class="n">psutil</span><span class="p">.</span><span class="n">AccessDenied</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">False</span>
</code></pre></div></div>

<h2 id="best-practices">Best Practices</h2>

<h3 id="security-considerations">Security Considerations</h3>

<ol>
  <li><strong>Principle of Least Privilege</strong> - Only request necessary permissions</li>
  <li><strong>Input Validation</strong> - Validate all PID inputs</li>
  <li><strong>Error Handling</strong> - Graceful handling of edge cases</li>
  <li><strong>Logging</strong> - Audit trail of monitoring activities</li>
</ol>

<h3 id="code-organization">Code Organization</h3>

<ol>
  <li><strong>Modular Design</strong> - Separate concerns into different modules</li>
  <li><strong>Configuration</strong> - Make syscall sets configurable</li>
  <li><strong>Testing</strong> - Unit tests for utility functions</li>
  <li><strong>Documentation</strong> - Clear inline documentation</li>
</ol>

<h2 id="usage-examples">Usage Examples</h2>

<h3 id="basic-file-monitoring">Basic File Monitoring</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Monitor a specific process</span>
python3 main.py 1234

<span class="c"># Monitor process by name</span>
python3 main.py <span class="si">$(</span>pgrep firefox<span class="si">)</span>

<span class="c"># Monitor with elevated privileges</span>
<span class="nb">sudo </span>python3 main.py 1234
</code></pre></div></div>

<h3 id="advanced-use-cases">Advanced Use Cases</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Monitor and log to file</span>
python3 main.py 1234 | <span class="nb">tee </span>file_access.log

<span class="c"># Filter specific file types</span>
python3 main.py 1234 | <span class="nb">grep</span> <span class="s1">'\.conf\|\.yaml\|\.json'</span>

<span class="c"># Monitor multiple processes (requires process spawning)</span>
<span class="k">for </span>pid <span class="k">in</span> <span class="si">$(</span>pgrep nginx<span class="si">)</span><span class="p">;</span> <span class="k">do
    </span>python3 main.py <span class="nv">$pid</span> &amp;
<span class="k">done</span>
</code></pre></div></div>

<h2 id="conclusion">Conclusion</h2>

<h3 id="key-takeaways">Key Takeaways</h3>

<ol>
  <li><strong>Python + ptrace = Powerful Monitoring</strong> - Combining Python’s ease with ptrace’s capabilities creates effective monitoring tools</li>
  <li><strong>Rich Context Matters</strong> - File metadata and process information provide valuable security insights</li>
  <li><strong>Modular Design Enables Flexibility</strong> - Well-structured code allows easy customization and extension</li>
  <li><strong>Real-time Monitoring Has Security Value</strong> - Live file access tracking enables rapid incident response</li>
</ol>

<h3 id="next-steps">Next Steps</h3>

<ol>
  <li><strong>Extend to Network Monitoring</strong> - Add socket syscall monitoring</li>
  <li><strong>Add Filtering Capabilities</strong> - Implement configurable filtering rules</li>
  <li><strong>Create Output Formats</strong> - JSON, CSV, or database integration</li>
  <li><strong>Build Alert System</strong> - Trigger alerts on suspicious patterns</li>
</ol>

<h2 id="additional-resources">Additional Resources</h2>

<h3 id="python-security-libraries">Python Security Libraries</h3>
<ul>
  <li><a href="https://github.com/giampaolo/psutil">psutil</a> - Cross-platform process utilities</li>
  <li><a href="https://github.com/vstinner/python-ptrace">python-ptrace</a> - Pure Python ptrace library</li>
</ul>

<h3 id="system-programming">System Programming</h3>
<ul>
  <li><a href="http://man7.org/tlpi/">Linux Programming Interface</a> - Comprehensive system programming guide</li>
  <li><a href="https://man7.org/linux/man-pages/man2/ptrace.2.html">ptrace(2) Manual</a> - Official ptrace documentation</li>
  <li><a href="https://syscalls.mebeim.net/?table=x86/64/x64/v6.2">System Call Table</a> - x86_64 syscall reference</li>
</ul>

<hr />

<p><em>This implementation provides a foundation for building sophisticated file access monitoring tools. The modular design allows for easy extension to cover additional syscalls, output formats, and integration with security frameworks.</em></p>

        
      </section>

      <footer class="page__meta">
        
        
  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      <a href="/tags/#file-monitoring" class="page__taxonomy-item p-category" rel="tag">file-monitoring</a><span class="sep">, </span>
    
      <a href="/tags/#ptrace" class="page__taxonomy-item p-category" rel="tag">ptrace</a><span class="sep">, </span>
    
      <a href="/tags/#python" class="page__taxonomy-item p-category" rel="tag">python</a><span class="sep">, </span>
    
      <a href="/tags/#security-tools" class="page__taxonomy-item p-category" rel="tag">security-tools</a><span class="sep">, </span>
    
      <a href="/tags/#syscalls" class="page__taxonomy-item p-category" rel="tag">syscalls</a>
    
    </span>
  </p>




  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      <a href="/categories/#linux" class="page__taxonomy-item p-category" rel="tag">linux</a><span class="sep">, </span>
    
      <a href="/categories/#security" class="page__taxonomy-item p-category" rel="tag">security</a><span class="sep">, </span>
    
      <a href="/categories/#system-monitoring" class="page__taxonomy-item p-category" rel="tag">system-monitoring</a>
    
    </span>
  </p>


        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time class="dt-published" datetime="2025-07-15T00:00:00+02:00">July 15, 2025</time></p>

      </footer>

      <section class="page__share">
  <h4 class="page__share-title">Share on</h4>

  <a href="https://x.com/intent/tweet?text=ptrace+System+Call+Hooking+in+Python+-+Building+a+File+Access+Monitor%20http%3A%2F%2Flocalhost%3A4000%2Flinux%2Fsecurity%2Fsystem-monitoring%2Fptrace-hooking-system-calls-linux-fundamental-part-01%2F" class="btn btn--x" aria-label="Share on X" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on X">
    <i class="fab fa-fw fa-x-twitter" aria-hidden="true"></i><span> X</span>
  </a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Flocalhost%3A4000%2Flinux%2Fsecurity%2Fsystem-monitoring%2Fptrace-hooking-system-calls-linux-fundamental-part-01%2F" class="btn btn--facebook" aria-label="Share on Facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook">
    <i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span>
  </a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=http://localhost:4000/linux/security/system-monitoring/ptrace-hooking-system-calls-linux-fundamental-part-01/" class="btn btn--linkedin" aria-label="Share on LinkedIn" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn">
    <i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span>
  </a>

  <a href="https://bsky.app/intent/compose?text=ptrace+System+Call+Hooking+in+Python+-+Building+a+File+Access+Monitor%20http%3A%2F%2Flocalhost%3A4000%2Flinux%2Fsecurity%2Fsystem-monitoring%2Fptrace-hooking-system-calls-linux-fundamental-part-01%2F" class="btn btn--bluesky" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Bluesky">
    <i class="fab fa-fw fa-bluesky" aria-hidden="true"></i><span> Bluesky</span>
  </a>
</section>


      

    </div>

    
  </article>

  
  
    
<div class="page__related">
  
  <h2 class="page__related-title">You may also enjoy</h2>
  <div class="grid__wrapper">
    
      
  </div>
</div>

  
</div>

      
    </div>

    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        

<div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
      
        
      
        
      
        
      
        
      
        
      
    

    
      <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>


<div class="page__footer-copyright">&copy; 2013 - 2025 <a href="http://localhost:4000">0x96f blog</a>. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/jekyll-themes/minimal-mistakes/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>









  </body>
</html>
